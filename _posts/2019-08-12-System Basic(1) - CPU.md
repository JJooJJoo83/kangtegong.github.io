---
layout: post
title: "시스템 기초(1) CPU-1"
image: ''
date: 2019-08-12 10:22:06
tags: 
- System
- Computer_Architecture
- Tutorials
description: 시스템 프로그래밍과 리버싱의 기본 소양 - CPU편
categories:
- System_Basic
---

## 시스템 프로그래밍의 기초(1) : CPU 편

### 프로그램의 실행과정
1. 프로그래머가 고급언어로 코드 작성
2. 프로그램을 컴파일하여 exe 파일로 변환
3. 프로그램이 실행될 때 exe 파일의 **복사본**이 메모리로 이동
4. cpu가 메모리에 있는 exe파일을 해석하고 실행
모든 프로그램은 **명령어**와 **데이터**로 구성된다.

### CPU의 구성 
1. 레지스터 : 처리 명령어나 데이터 보관하는 영역 (일종의 메모리)

2. 제어장치 :  메모리의 명령어와 데이터를 읽은 후 레지스터에 집어넣
3. 고 명령어가 실행되는 결과에 따라 시스템 전체를 제어
*제어 : 연산 이외의 처리과정*
4. 연산장치 : 연산

5. 클록 : 클록신호 발생 (CPU외부에 있는 경우도 있다)

### 메인 메모리 (주기억 장치)

주로 Dram
그래서 전원이 꺼지면 정보가 사라짐
1바이트 (8바이트) 단위로 구성
어드레스(주소)가 있어, 이걸 바탕으로 정보 위치 판단

## 레지스터로 이루어진 CPU

### 레지스터 & 어셈블리어

프로그래머가 프로그램 제어와 관련해 알아야 할 건 사실상 레지스터가 전부다. 프로그램이 레지스터를 이용해 데이터를 처리하기 때문.

레지스터의 동작원리를 이해하면 CPU의 동작원리를 이해하기 쉽고
이 레지스터의 동작원리는 어셈블리어를 보면 이해가 편하다

컴퓨터가 이해하는 언어는 기계어로, 본질적으로는 전기신호를 그대로 해석한 것이다. 어셈블리어는 기계어 명령어에 그 기능을 의미하는 영어로 된 줄임말을 대응시킨 것이다. (그러므로 어셈블리어는 기계어와 1:1대응한다.)

어셈블리어를 기계어로 변환하는 걸 어셈블,
기계어를 어셈블리어로 변환시키는 걸 역어셈블이라고 한다.
여기서 컴파일과 헷갈리는 경우가 많은데, 
컴파일은 단순히 고급언어로 작성된 프로그램을 기계어로 변환하는 일을 말한다.

    mov eax, dword ptr [ebp-8]
    add eax, dword ptr [ebp-0Ch]
    mov dword ptr [ebp-4], eax

다음은 어셈블리어 코드의 예시이다.
eax와 ebp는 CPU 레지스터의 종류이다. (다양한 레지스터의 종류들은 리버싱을 배우게 될 때 지겹게도 반복할 테니 여기서는 외울 필요가 없다)

레지스터도 메모리의 일종이기 때문에, 명령어와 데이터를 저장한다. 데이터에는 연산에 사용될 데이터와 메모리 주소, 두 종류의 데이터가 있다.

이 두 종류의 데이터가 있기 때문에 연산에 사용되는 값을 담기 위한 ACC (eax)와 메모리 주소를 담기 위한 베이스 레지스터(ebx) 와 인덱스 레지스터가 존재하는 것.

일반적으로, CPU 레지스터에는 
1. 프로그램 카운터 
2. 플래그 레지스터 
3. ACC (어큐뮬레이터) 
4. 베이스 레지스터 
5. 인덱스 레지스터 
6. 범용 레지스터 

\+ 알파가 존재한다.

### 프로그램의 흐름을 제어하는 프로그램 카운터

작성된 프로그램이 실행되는 원리
프로그램의 흐름을 제시하는 레지스터인 프로그램 카운터 (PC).

대부분의 OS는, 프로그램이 실행되면, **하드디스크**에 보존된 프로그램을 **메모리**에 복사한다.

일반적으로 하나의 명령어나 데이터는 여러 개의 어드레스에 걸쳐 보관된다.

![PC원리]({{ '/assets/images/원리/1-1.png' | relative_url }}){: .center-image }

여기서 어드레스 0100이 프로그램 실행 시작 위치가 된다.
OS가 하드디스크의 프로그램을 메모리로 복사한 후 PC에 0100을 집어 넣게 된다. 그 이후 자동으로 PC값이 1씩 증가하며 
*(이 때, 둘 이상의 메모리 어드레스를 차지하는 명령어가 실행되면 1이 아닌 명령어 크기만큼 증가)* 
제어장치는 프로그램 카운터의 값을 참조해 메모리에서 명령어를 읽어내어 실행한다.